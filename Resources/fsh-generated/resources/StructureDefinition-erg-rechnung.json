{
  "resourceType": "StructureDefinition",
  "id": "erg-rechnung",
  "url": "https://gematik.de/fhir/erg/StructureDefinition/erg-rechnung",
  "version": "1.0.0-CC",
  "name": "ERGRechnung",
  "title": "ERG Rechnung",
  "status": "active",
  "experimental": false,
  "date": "2024-06-20",
  "publisher": "gematik GmbH",
  "contact": [
    {
      "telecom": [
        {
          "system": "url",
          "value": "http://gematik.de/"
        }
      ]
    }
  ],
  "fhirVersion": "4.0.1",
  "kind": "resource",
  "abstract": false,
  "type": "Invoice",
  "baseDefinition": "http://hl7.org/fhir/StructureDefinition/Invoice",
  "derivation": "constraint",
  "differential": {
    "element": [
      {
        "id": "Invoice.extension",
        "path": "Invoice.extension",
        "min": 2
      },
      {
        "id": "Invoice.extension:pdf-repraesentation-rechnung",
        "path": "Invoice.extension",
        "sliceName": "pdf-repraesentation-rechnung",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "Extension",
            "profile": [
              "https://gematik.de/fhir/erg/StructureDefinition/erg-pdf-repraesentation-rechnung"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Invoice.extension:Behandlungszeitraum",
        "path": "Invoice.extension",
        "sliceName": "Behandlungszeitraum",
        "short": "Behandlungszeitraum",
        "comment": "Der Behandlungszeitraum SOLL vorhanden sein.",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "Extension",
            "profile": [
              "http://hl7.org/fhir/5.0/StructureDefinition/extension-Invoice.period[x]"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Invoice.extension:Behandlungszeitraum.value[x]",
        "path": "Invoice.extension.value[x]",
        "slicing": {
          "discriminator": [
            {
              "type": "type",
              "path": "$this"
            }
          ],
          "ordered": false,
          "rules": "open"
        }
      },
      {
        "id": "Invoice.extension:Behandlungszeitraum.value[x]:valuePeriod",
        "path": "Invoice.extension.value[x]",
        "sliceName": "valuePeriod",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "Period"
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Invoice.extension:Behandlungszeitraum.value[x]:valuePeriod.start",
        "path": "Invoice.extension.value[x].start",
        "short": "Startdatum",
        "mustSupport": true
      },
      {
        "id": "Invoice.extension:Behandlungszeitraum.value[x]:valuePeriod.end",
        "path": "Invoice.extension.value[x].end",
        "short": "Enddatum",
        "mustSupport": true
      },
      {
        "id": "Invoice.extension:AbrechnungsDiagnoseProzedur",
        "path": "Invoice.extension",
        "sliceName": "AbrechnungsDiagnoseProzedur",
        "min": 0,
        "max": "*",
        "type": [
          {
            "code": "Extension",
            "profile": [
              "https://gematik.de/fhir/erg/StructureDefinition/ERGAbrechnungsDiagnoseProzedur"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Invoice.extension:AbrechnungsDiagnoseProzedur.extension:Use",
        "path": "Invoice.extension.extension",
        "sliceName": "Use"
      },
      {
        "id": "Invoice.extension:AbrechnungsDiagnoseProzedur.extension:Use.value[x]",
        "path": "Invoice.extension.extension.value[x]",
        "short": "Kennzeichen Hauptdiagnose",
        "comment": "Das Kennzeichen Hauptdiagnose SOLL vorhanden sein.",
        "mustSupport": true
      },
      {
        "id": "Invoice.extension:AbrechnungsDiagnoseProzedur.extension:Use.value[x].code",
        "path": "Invoice.extension.extension.value[x].code",
        "patternCode": "main-diagnosis"
      },
      {
        "id": "Invoice.extension:AbrechnungsDiagnoseProzedur.extension:Referenz",
        "path": "Invoice.extension.extension",
        "sliceName": "Referenz"
      },
      {
        "id": "Invoice.extension:AbrechnungsDiagnoseProzedur.extension:Referenz.value[x]",
        "path": "Invoice.extension.extension.value[x]",
        "short": "Zuordnung von Diagnosen oder Prozeduren zur Rechnung",
        "comment": "Diagnosen und Prozeduren SOLLEN zur Rechnung zugeordnet sein.",
        "mustSupport": true
      },
      {
        "id": "Invoice.extension:Benhandlungsart",
        "path": "Invoice.extension",
        "sliceName": "Benhandlungsart",
        "short": "Behandlungsart",
        "comment": "Die Behandlungsart MUSS vorhanden sein.",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "Extension",
            "profile": [
              "https://gematik.de/fhir/erg/StructureDefinition/erg-behandlungsart"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Invoice.extension:Benhandlungsart.value[x]",
        "path": "Invoice.extension.value[x]",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.extension:Benhandlungsart.value[x].system",
        "path": "Invoice.extension.value[x].system",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.extension:Benhandlungsart.value[x].code",
        "path": "Invoice.extension.value[x].code",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.extension:Fachrichtung",
        "path": "Invoice.extension",
        "sliceName": "Fachrichtung",
        "short": "Fachrichtung",
        "comment": "Die Fachrichtung MUSS vorhanden sein.",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "Extension",
            "profile": [
              "https://gematik.de/fhir/erg/StructureDefinition/erg-fachrichtung"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Invoice.extension:Fachrichtung.value[x]",
        "path": "Invoice.extension.value[x]",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.extension:Fachrichtung.value[x].system",
        "path": "Invoice.extension.value[x].system",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.extension:Fachrichtung.value[x].code",
        "path": "Invoice.extension.value[x].code",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.identifier",
        "path": "Invoice.identifier",
        "slicing": {
          "discriminator": [
            {
              "type": "pattern",
              "path": "$this"
            }
          ],
          "rules": "open"
        },
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.identifier:Rechnungsnummer",
        "path": "Invoice.identifier",
        "sliceName": "Rechnungsnummer",
        "short": "Rechnungs-Nr. (der LEI)",
        "comment": "Die Rechnungs-Nr. (der LEI) MUSS vorhanden sein.",
        "min": 1,
        "max": "1",
        "patternIdentifier": {
          "type": {
            "coding": [
              {
                "code": "invoice",
                "system": "http://TODO.de"
              }
            ]
          }
        },
        "mustSupport": true
      },
      {
        "id": "Invoice.identifier:Rechnungsnummer.type",
        "path": "Invoice.identifier.type",
        "min": 1,
        "patternCodeableConcept": {
          "coding": [
            {
              "code": "invoice",
              "system": "http://TODO.de"
            }
          ]
        },
        "mustSupport": true
      },
      {
        "id": "Invoice.identifier:Rechnungsnummer.system",
        "path": "Invoice.identifier.system",
        "short": "NamingSystem der Rechnungs-Nr. (der LEI)",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.identifier:Rechnungsnummer.value",
        "path": "Invoice.identifier.value",
        "short": "Rechnungs-Nr. (der LEI)",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.identifier:Antragsnummer",
        "path": "Invoice.identifier",
        "sliceName": "Antragsnummer",
        "short": "Referenz auf Heil- und Kostenplan, Kostenvoranschlag oder Kostenübernahmeantrag",
        "comment": "Die Rechnungs-Nr. (der LEI) MUSS vorhanden sein.",
        "min": 0,
        "max": "1",
        "patternIdentifier": {
          "type": {
            "coding": [
              {
                "code": "Auftragsnummer",
                "system": "http://TODO.de"
              }
            ]
          }
        },
        "mustSupport": true
      },
      {
        "id": "Invoice.identifier:Antragsnummer.type",
        "path": "Invoice.identifier.type",
        "min": 1,
        "patternCodeableConcept": {
          "coding": [
            {
              "code": "Auftragsnummer",
              "system": "http://TODO.de"
            }
          ]
        },
        "mustSupport": true
      },
      {
        "id": "Invoice.identifier:Antragsnummer.system",
        "path": "Invoice.identifier.system",
        "short": "NamingSystem der Rechnungs-Nr. (der LEI)",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.identifier:Antragsnummer.value",
        "path": "Invoice.identifier.value",
        "short": "Rechnungs-Nr. (der LEI)",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.status",
        "path": "Invoice.status",
        "short": "Status der Rechnung",
        "comment": "Der Status MUSS vorhanden sein. Im Normalfall ist der Code 'issued' anzugeben.",
        "mustSupport": true
      },
      {
        "id": "Invoice.type",
        "path": "Invoice.type",
        "mustSupport": true
      },
      {
        "id": "Invoice.type.coding",
        "path": "Invoice.type.coding",
        "slicing": {
          "discriminator": [
            {
              "type": "pattern",
              "path": "$this"
            }
          ],
          "rules": "open"
        },
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.type.coding:AusrichtungDerRechnung",
        "path": "Invoice.type.coding",
        "sliceName": "AusrichtungDerRechnung",
        "short": "Abrechnungsart der Rechnung",
        "comment": "Die Grundsätzliche Ausrichtung der Rechnung (Abrechnungsart) SOLL vorhanden sein.",
        "min": 0,
        "max": "1",
        "patternCoding": {
          "system": "https://gematik.de/fhir/erg/CodeSystem/erg-rechnung-abrechnungsart-cs"
        },
        "mustSupport": true,
        "binding": {
          "strength": "required",
          "valueSet": "https://gematik.de/fhir/erg/ValueSet/erg-rechnung-abrechnungsart-vs"
        }
      },
      {
        "id": "Invoice.type.coding:AusrichtungDerRechnung.extension:Zusatzinformation",
        "path": "Invoice.type.coding.extension",
        "sliceName": "Zusatzinformation",
        "short": "Zusatzinformation zur Abrechnungsart",
        "comment": "Die Zusatzinformation zur Abrechnungsart SOLL vorhanden sein, wenn es sich um eine Abrechnung nach §13 Abs. 2 SGB V handelt.",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "Extension",
            "profile": [
              "https://gematik.de/fhir/erg/StructureDefinition/ERGZusatzinformationZurAbrechnungsart"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Invoice.type.coding:AusrichtungDerRechnung.extension:Zusatzinformation.value[x]",
        "path": "Invoice.type.coding.extension.value[x]",
        "mustSupport": true
      },
      {
        "id": "Invoice.type.coding:AusrichtungDerRechnung.system",
        "path": "Invoice.type.coding.system",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.type.coding:AusrichtungDerRechnung.code",
        "path": "Invoice.type.coding.code",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.subject",
        "path": "Invoice.subject",
        "short": "Behandelte Person",
        "min": 1,
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "https://gematik.de/fhir/erg/StructureDefinition/erg-person",
              "http://hl7.org/fhir/StructureDefinition/Patient"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Invoice.subject.reference",
        "path": "Invoice.subject.reference",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.subject.display",
        "path": "Invoice.subject.display",
        "short": "Name der behandelten Person",
        "comment": "Der Name der behandelten Person SOLL angegeben werden und kann vom Rechnungsempfänger abweichen, z.B. wenn Eltern Rechnungen für ihre Kinder erhalten.",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.recipient",
        "path": "Invoice.recipient",
        "short": "Rechnungsempfänger",
        "comment": "Das System des Leistungserbringers referenziert hier üblicherweise \n  auf die lokale Instanz des Patienten um die Rechnung einer Patientenakte zuzuordnen. \n  Der Fachdienst substitutiert den Link mit der Referenz auf das Postfach des Patienten \n  bei der Extraktion der Invoice aus dem Bundle. Die Angabe der Versichertennummer dient \n  der Plausibilisierung. Die KV-Nummer in der Instanz des Bundles muss daher mit der \n  KV-Nummer übereinstimmen, die im Fachdienst für das Postfach des Rechnungsempfängers hinterlegt ist. ",
        "min": 1,
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "https://gematik.de/fhir/erg/StructureDefinition/erg-person",
              "http://hl7.org/fhir/StructureDefinition/Patient"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Invoice.recipient.reference",
        "path": "Invoice.recipient.reference",
        "mustSupport": true
      },
      {
        "id": "Invoice.recipient.identifier",
        "path": "Invoice.recipient.identifier",
        "min": 1,
        "type": [
          {
            "code": "Identifier",
            "profile": [
              "http://fhir.de/StructureDefinition/identifier-kvid-10"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Invoice.recipient.display",
        "path": "Invoice.recipient.display",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.date",
        "path": "Invoice.date",
        "short": "Rechnungsdatum",
        "comment": "Das Rechnungsdatum MUSS vorhanden sein.",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.participant",
        "path": "Invoice.participant",
        "slicing": {
          "discriminator": [
            {
              "type": "pattern",
              "path": "role"
            }
          ],
          "rules": "open"
        },
        "short": "weitere behandelnde Leistungserbringer oder abweichender Forderungsinhaber",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.participant.role",
        "path": "Invoice.participant.role",
        "mustSupport": true,
        "binding": {
          "strength": "required",
          "valueSet": "https://gematik.de/fhir/erg/ValueSet/erg-participant-role-VS"
        }
      },
      {
        "id": "Invoice.participant:Leistungserbringer",
        "path": "Invoice.participant",
        "sliceName": "Leistungserbringer",
        "short": "Weitere behandelnde Leistungserbringer",
        "comment": "Weitere behandelnde Leistungserbringer SOLLEN vorhanden sein.",
        "min": 1,
        "max": "*",
        "mustSupport": true
      },
      {
        "id": "Invoice.participant:Leistungserbringer.role",
        "path": "Invoice.participant.role",
        "min": 1,
        "patternCodeableConcept": {
          "coding": [
            {
              "code": "leistungserbringer",
              "system": "https://gematik.de/fhir/erg/CodeSystem/erg-participant-role-CS"
            }
          ]
        }
      },
      {
        "id": "Invoice.participant:Leistungserbringer.actor",
        "path": "Invoice.participant.actor",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "https://gematik.de/fhir/erg/StructureDefinition/erg-leistungserbringer-person",
              "https://gematik.de/fhir/erg/StructureDefinition/erg-institution",
              "http://hl7.org/fhir/StructureDefinition/Practitioner",
              "http://hl7.org/fhir/StructureDefinition/Organization"
            ]
          }
        ]
      },
      {
        "id": "Invoice.participant:Forderungsinhaber",
        "path": "Invoice.participant",
        "sliceName": "Forderungsinhaber",
        "short": "Abweichender Forderungsinhaber",
        "comment": "Der abweichender Forderungsinhaber SOLL vorhanden sein.",
        "min": 0,
        "max": "1",
        "mustSupport": true
      },
      {
        "id": "Invoice.participant:Forderungsinhaber.role",
        "path": "Invoice.participant.role",
        "min": 1,
        "patternCodeableConcept": {
          "coding": [
            {
              "code": "forderungsinhaber",
              "system": "https://gematik.de/fhir/erg/CodeSystem/erg-participant-role-CS"
            }
          ]
        }
      },
      {
        "id": "Invoice.participant:Forderungsinhaber.actor",
        "path": "Invoice.participant.actor",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "https://gematik.de/fhir/erg/StructureDefinition/erg-leistungserbringer-person",
              "https://gematik.de/fhir/erg/StructureDefinition/erg-institution",
              "http://hl7.org/fhir/StructureDefinition/Practitioner",
              "http://hl7.org/fhir/StructureDefinition/Organization"
            ]
          }
        ]
      },
      {
        "id": "Invoice.issuer",
        "path": "Invoice.issuer",
        "short": "Rechnungsersteller",
        "comment": "Der Rechnungsersteller MUSS vorhanden sein.",
        "min": 1,
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "https://gematik.de/fhir/erg/StructureDefinition/erg-institution",
              "http://hl7.org/fhir/StructureDefinition/Organization"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Invoice.issuer.reference",
        "path": "Invoice.issuer.reference",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.lineItem",
        "path": "Invoice.lineItem",
        "short": "Rechnungspositionen",
        "mustSupport": true
      },
      {
        "id": "Invoice.lineItem.chargeItem[x]",
        "path": "Invoice.lineItem.chargeItem[x]",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "http://hl7.org/fhir/StructureDefinition/ChargeItem"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Invoice.totalPriceComponent",
        "path": "Invoice.totalPriceComponent",
        "slicing": {
          "discriminator": [
            {
              "type": "pattern",
              "path": "code"
            }
          ],
          "rules": "open"
        },
        "mustSupport": true
      },
      {
        "id": "Invoice.totalPriceComponent:tax",
        "path": "Invoice.totalPriceComponent",
        "sliceName": "tax",
        "short": "Steuersatz und -Betrag",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "BackboneElement"
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Invoice.totalPriceComponent:tax.type",
        "path": "Invoice.totalPriceComponent.type",
        "patternCode": "tax"
      },
      {
        "id": "Invoice.totalPriceComponent:tax.factor",
        "path": "Invoice.totalPriceComponent.factor",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.totalPriceComponent:tax.amount",
        "path": "Invoice.totalPriceComponent.amount",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Invoice.totalNet",
        "path": "Invoice.totalNet",
        "short": "Nettobetrag der Rechnungssumme",
        "mustSupport": true
      },
      {
        "id": "Invoice.totalGross",
        "path": "Invoice.totalGross",
        "short": "Bruttobetrag der Rechnungssumme",
        "mustSupport": true
      },
      {
        "id": "Invoice.paymentTerms.extension",
        "path": "Invoice.paymentTerms.extension",
        "slicing": {
          "discriminator": [
            {
              "type": "value",
              "path": "url"
            }
          ],
          "ordered": false,
          "rules": "open"
        },
        "min": 1
      },
      {
        "id": "Invoice.paymentTerms.extension:zahlungsziel",
        "path": "Invoice.paymentTerms.extension",
        "sliceName": "zahlungsziel",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "Extension",
            "profile": [
              "https://gematik.de/fhir/erg/StructureDefinition/erg-zahlungsziel"
            ]
          }
        ],
        "mustSupport": true
      }
    ]
  }
}
